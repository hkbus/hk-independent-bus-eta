import{w,j as n,a6 as b,r as a,a8 as j,ag as C,bk as g,bl as R,ac as x,a0 as E,a1 as A,ak as d,ae as M}from"./index-C1QwAi2s.js";import{l as I}from"./lzutf8-light-4EbDmOqq.js";import{t as F}from"./index-BAEFjCl2.js";import{u as T,e as k,f as D}from"./App-DZK4CLd6.js";const O=w(n.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check"),U=()=>{const{data:s}=T(),{t:i}=b(),{importAppState:p}=a.useContext(j),{importCollectionState:h}=a.useContext(C),m=k(),[c,y]=a.useState(s??""),f=a.useMemo(()=>F(t=>{try{return JSON.parse(I.decompress(decodeURIComponent(t).replace(/-/g,"/"),{inputEncoding:"Base64"}))}catch{return{}}},500),[]),e=a.useMemo(()=>{try{let t=f(s??c.split("/").pop()??"");if(!Array.isArray(t.savedStops)||!g(t.savedStops))throw new Error("Error in parsing savedStops");if(!Array.isArray(t.savedEtas)||!g(t.savedEtas))throw new Error("Error in parsing savedEtas");if(!Array.isArray(t.collections))throw new Error("Error in parsing collections");for(let r=0;r<t.collections.length;++r){if(typeof t.collections[r].name!="string")throw new Error("Error in parsing collections");for(let o=0;o<t.collections[r].list.length;++o)if(typeof t.collections[r].list[o]!="string")throw new Error("Error in parsing collections");for(let o=0;o<t.collections[r].schedules.length;++o){if(typeof t.collections[r].schedules[o].day!="number")throw new Error("Error in parsing collections");if(typeof t.collections[r].schedules[o].start.hour!="number")throw new Error("Error in parsing collections");if(typeof t.collections[r].schedules[o].start.minute!="number")throw new Error("Error in parsing collections");if(typeof t.collections[r].schedules[o].end.hour!="number")throw new Error("Error in parsing collections");if(typeof t.collections[r].schedules[o].end.minute!="number")throw new Error("Error in parsing collections")}}return t}catch(t){console.error(t)}return{}},[f,s,c]),u=a.useMemo(()=>{var t,r;return(((t=e.savedEtas)==null?void 0:t.length)??0)+(((r=e.collections)==null?void 0:r.reduce((o,v)=>o+v.list.length,0))??0)},[e]),l=a.useMemo(()=>JSON.stringify(e,null,2),[e]),S=a.useCallback(()=>{l!=="{}"&&(h({savedStops:e.savedStops??[],savedEtas:e.savedEtas??[],collections:e.collections??[],collectionDrawerRoute:null,collectionIdx:null}),p({geoPermission:null,compassPermission:"default",manualGeolocation:null,searchRoute:"",selectedRoute:"1-1-CHUK-YUEN-ESTATE-STAR-FERRY",routeSearchHistory:e.routeSearchHistory??[],isRouteFilter:e.isRouteFilter??!0,busSortOrder:e.busSortOrder??"KMB first",numPadOrder:e.numPadOrder??"123456789c0b",etaFormat:e.etaFormat??"diff",_colorMode:e._colorMode??"system",energyMode:e.energyMode??!1,platformMode:e.platformMode??!1,vibrateDuration:e.vibrateDuration??1,isVisible:!0,analytics:e.analytics??!0,refreshInterval:e.refreshInterval??30,annotateScheduled:e.annotateScheduled??!0,isRecentSearchShown:e.isRecentSearchShown??!0,fontSize:e.fontSize??16,searchRange:e.searchRange??R,isSearching:e.isSearching??!1}),m("/"))},[e,l,p,h,m]);return n.jsxs(x,{sx:P,children:[n.jsx(E,{variant:"h6",sx:{textAlign:"center"},children:i("資料匯入")}),!s&&n.jsx(D,{variant:"outlined",value:c,onChange:({target:{value:t}})=>y(t),fullWidth:!0,label:i("匯出網址")}),l!=="{}"&&n.jsxs(x,{sx:{pl:1},children:[n.jsx(E,{variant:"h6",children:i("資料匯入概括")}),n.jsxs(A,{disablePadding:!0,dense:!0,sx:{listStyleType:"disc",pl:4},children:[e.savedStops.length>0&&n.jsx(d,{sx:{display:"list-item"},children:e.savedStops.length+i("個已收藏車站",{count:e.savedStops.length})}),u>0&&n.jsx(d,{sx:{display:"list-item"},children:u+i("個到站預報",{count:u})}),n.jsx(d,{sx:{display:"list-item"},children:i("個性化設定")})]})]}),n.jsx(M,{startIcon:n.jsx(O,{}),variant:"outlined",disabled:l==="{}",onClick:S,sx:L,children:i("確定")})]})},P={display:"flex",flexDirection:"column",justifyContent:"flex-start",flex:1,gap:1,m:1},L={color:s=>s.palette.mode==="light"?s.palette.text.primary:s.palette.primary.main,borderColor:s=>s.palette.mode==="light"?s.palette.text.primary:s.palette.primary.main};export{U as default};
